<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المحقق الذكي AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #020617; color: #f8fafc; margin: 0; }
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .input-area { background: rgba(30, 41, 59, 0.5); border: 2px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .input-area:focus { border-color: #6366f1; background: rgba(30, 41, 59, 0.8); outline: none; box-shadow: 0 0 20px rgba(99, 102, 241, 0.2); }
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const Icons = {
            Brain: () => <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-indigo-500"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-2.54Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-2.54Z"/></svg>,
            Magic: () => <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M3 5h4"/><path d="M21 17v4"/><path d="M19 19h4"/></svg>,
            Loading: () => <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
        };

        // ملاحظة مهمة: يجب وضع مفتاح API الخاص بك هنا ليعمل الموقع على GitHub
        const apiKey = "AIzaSyDkGQa1JLMkA_McySWM1f_9lmZWhrDAr5w"; 
        const MODEL_NAME = "gemini-2.5-flash-preview-09-2025";

        function App() {
            const [userInput, setUserInput] = useState("");
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState("");

            const handleGuess = async () => {
                if (!userInput.trim()) return;
                if (!apiKey) {
                    setError("خطأ: مفتاح API غير موجود. يرجى إضافة المفتاح في ملف الكود.");
                    return;
                }

                setLoading(true);
                setError("");

                const prompt = `خمن الشيء الذي يصفه المستخدم أدناه باللغة العربية.
                الوصف: "${userInput}"
                يجب أن تكون الإجابة بتنسيق JSON حصراً:
                {"guess": "اسم الشيء", "reason": "لماذا", "confidence": "نسبة", "category": "فئة"}`;

                // نظام إعادة المحاولة (Exponential Backoff)
                const fetchWithRetry = async (retries = 5, delay = 1000) => {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                        });
                        
                        if (!response.ok) throw new Error('API_ERROR');
                        return await response.json();
                    } catch (err) {
                        if (retries > 0) {
                            await new Promise(res => setTimeout(res, delay));
                            return fetchWithRetry(retries - 1, delay * 2);
                        }
                        throw err;
                    }
                };

                try {
                    const data = await fetchWithRetry();
                    let rawText = data.candidates[0].content.parts[0].text;
                    rawText = rawText.replace(/```json/g, "").replace(/```/g, "").trim();
                    setResult(JSON.parse(rawText));
                } catch (err) {
                    setError("تعذر الاتصال بالذكاء الاصطناعي. تأكد من صحة مفتاح الـ API الخاص بك.");
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    {!result ? (
                        <div className="glass-panel max-w-xl w-full p-8 md:p-12 rounded-[2rem] shadow-2xl animate-fade-in text-center">
                            <div className="flex justify-center mb-6"><Icons.Brain /></div>
                            <h1 className="text-3xl font-black mb-3 text-white">المحقق الذكي</h1>
                            <p className="text-slate-400 mb-8">اشرح الشيء بأسلوبك وسأخمنه فوراً.</p>
                            
                            <textarea 
                                value={userInput}
                                onChange={(e) => setUserInput(e.target.value)}
                                className="w-full h-40 p-5 rounded-2xl input-area text-white text-lg placeholder-slate-600 resize-none mb-6"
                                placeholder="مثال: شيء إلكتروني نلعب به ألعاب مثل Minecraft..."
                            />

                            {error && <div className="bg-red-500/10 border border-red-500/20 text-red-400 p-3 rounded-xl mb-4 text-sm">{error}</div>}

                            <button 
                                onClick={handleGuess}
                                disabled={loading || !userInput.trim()}
                                className="gradient-bg w-full py-4 rounded-2xl font-bold text-xl flex items-center justify-center gap-3 hover:opacity-90 transition-all disabled:opacity-50"
                            >
                                {loading ? <Icons.Loading /> : <><Icons.Magic /> خمن الآن</>}
                            </button>
                        </div>
                    ) : (
                        <div className="glass-panel max-w-xl w-full p-8 md:p-12 rounded-[2rem] shadow-2xl animate-fade-in text-center">
                            <div className="mb-2">
                                <span className="px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-400 text-xs font-bold uppercase border border-indigo-500/30">
                                    {result.category}
                                </span>
                            </div>
                            <h2 className="text-slate-500 font-bold text-sm mb-2 uppercase tracking-widest">التخمين:</h2>
                            <h1 className="text-5xl md:text-6xl font-black mb-6 text-white">{result.guess}</h1>
                            
                            <div className="bg-white/5 p-6 rounded-2xl mb-8 border border-white/10">
                                <p className="text-slate-300 italic text-right leading-relaxed">"{result.reason}"</p>
                            </div>

                            <button 
                                onClick={() => {setResult(null); setUserInput("");}}
                                className="w-full py-4 bg-slate-800 hover:bg-slate-700 rounded-2xl font-bold transition-all text-white border border-white/5"
                            >
                                تجربة وصف جديد
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

